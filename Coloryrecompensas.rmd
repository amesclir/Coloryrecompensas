---
title: "Color y recompensas"
author: "Marcial"
date: "01/09/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---
1. Install and load packages

```{r, echo = F}
#install.packages("picante")
#This will install also package dependences
library(picante)
#This will also load package dependences
#library(ape)
#library(vegan)
#library(permute)
#library(lattice)
#library(nlme)

#install.packages("brranching")
library(brranching)

```


3. Frequency matrix.

```{r, echo = F}
mydata <- read.csv("mydata3.csv", sep = ",", header=TRUE, stringsAsFactors=FALSE, fileEncoding="latin1")
mydata

```



3. Create your tree and plot

```{r, echo = F}

taxa <- as.character(mydata[,2])
mytree <- phylomatic(taxa=taxa,get = 'POST', storedtree = "zanne2014",nodes = FALSE)
plot(mytree, no.margin=TRUE, cex = 0.8)

names(mytree)
mytree$node.label <- ""

write.tree(mytree, file = "mytree.tree")

```



```{r, echo = F}
library(caper)

mytree2 <- read.tree(file="mytree.tree")
write(mytree2$tip.label, "tips.txt")
#fix the names in case you did not
mydata <- read.csv("mydata3.csv", sep = ",", header=TRUE, stringsAsFactors=FALSE, fileEncoding="latin1")
mydata

class(mytree2)
plot(mytree2)
color <- comparative.data(mytree2, mydata, X2.Especies2, vcv=TRUE, vcv.dim=2, na.omit=F, 
	             force.root=FALSE, warn.dropped=T, scope=NULL)
plot(color$phy)
color$phy
color$dropped

    lambda.result1 <- pgls(X3.MSUG ~ X5.NPOL, color, lambda = "ML")
    summary(lambda.result1)
    lambda.result2 <- pgls(X3.MSUG ~ X6.VPOL, color, lambda = "ML")
    summary(lambda.result2)
    lambda.result3 <- pgls(X3.MSUG ~ X9.SIZ, color, lambda = "ML")
    summary(lambda.result3)
    lambda.result4 <- pgls(X3.MSUG ~ X9.SIZ, color, lambda = "ML")
    summary(lambda.result4)
    lambda.result5 <- pgls(X3.MSUG ~ X12.HUE, color, lambda = "ML")
    summary(lambda.result5)
    lambda.result6 <- pgls(X3.MSUG ~ X13.BRI, color, lambda = "ML")
    summary(lambda.result6)
    lambda.result7 <- pgls(X3.MSUG ~ X14.CHR, color, lambda = "ML")
    summary(lambda.result7)
    lambda.result8 <- pgls(X3.MSUG ~ X15.UV, color, lambda = "ML")
    summary(lambda.result8)
    lambda.result9 <- pgls(X3.MSUG ~ X16.GC, color, lambda = "ML")
    summary(lambda.result9)
    lambda.result10 <- pgls(X3.MSUG ~ X17.DIST, color, lambda = "ML")
    summary(lambda.result10)
    
    lambda.resultb1 <- pgls(X4.CSUG ~ X5.NPOL, color, lambda = "ML")
    summary(lambda.resultb1)
    lambda.resultb2 <- pgls(X4.CSUG ~ X6.VPOL, color, lambda = "ML")
    summary(lambda.resultb2)
    lambda.resultb3 <- pgls(X4.CSUG ~ X9.SIZ, color, lambda = "ML")
    summary(lambda.resultb3)
    lambda.resultb4 <- pgls(X4.CSUG ~ X9.SIZ, color, lambda = "ML")
    summary(lambda.resultb4)
    lambda.resultb5 <- pgls(X4.CSUG ~ X12.HUE, color, lambda = "ML")
    summary(lambda.resultb5)
    lambda.resultb6 <- pgls(X4.CSUG ~ X13.BRI, color, lambda = "ML")
    summary(lambda.resultb6)
    lambda.resultb7 <- pgls(X4.CSUG ~ X14.CHR, color, lambda = "ML")
    summary(lambda.resultb7)
    lambda.resultb8 <- pgls(X4.CSUG ~ X15.UV, color, lambda = "ML")
    summary(lambda.resultb8)
    lambda.resultb9 <- pgls(X4.CSUG ~ X16.GC, color, lambda = "ML")
    summary(lambda.resultb9)
    lambda.resultb10 <- pgls(X4.CSUG ~ X17.DIST, color, lambda = "ML")
    summary(lambda.resultb10)

    lambda.resultc1 <- pgls(X5.NPOL ~ X3.MSUG, color, lambda = "ML")
    summary(lambda.resultc1)
    lambda.resultc2 <- pgls(X5.NPOL ~ X4.CSUG, color, lambda = "ML")
    summary(lambda.resultc2)
    lambda.resultc3 <- pgls(X5.NPOL ~ X9.SIZ, color, lambda = "ML")
    summary(lambda.resultc3)
    lambda.resultc4 <- pgls(X5.NPOL ~ X9.SIZ, color, lambda = "ML")
    summary(lambda.resultc4)
    lambda.resultc5 <- pgls(X5.NPOL ~ X12.HUE, color, lambda = "ML")
    summary(lambda.resultc5)
    lambda.resultc6 <- pgls(X5.NPOL ~ X13.BRI, color, lambda = "ML")
    summary(lambda.resultc6)
    lambda.resultc7 <- pgls(X5.NPOL ~ X14.CHR, color, lambda = "ML")
    summary(lambda.resultc7)
    lambda.resultc8 <- pgls(X5.NPOL ~ X15.UV, color, lambda = "ML")
    summary(lambda.resultc8)
    lambda.resultc9 <- pgls(X5.NPOL ~ X16.GC, color, lambda = "ML")
    summary(lambda.resultc9)
    lambda.resultc10 <- pgls(X5.NPOL ~ X17.DIST, color, lambda = "ML")
    summary(lambda.resultc10)
    
    
    lambda.resultd1 <- pgls(X6.VPOL ~ X3.MSUG, color, lambda = "ML")
    summary(lambda.resultd1)
    lambda.resultd2 <- pgls(X6.VPOL ~ X4.CSUG, color, lambda = "ML")
    summary(lambda.resultd2)
    lambda.resultd3 <- pgls(X6.VPOL ~ X9.SIZ, color, lambda = "ML")
    summary(lambda.resultd3)
    lambda.resultd4 <- pgls(X6.VPOL ~ X9.SIZ, color, lambda = "ML")
    summary(lambda.resultd4)
    lambda.resultd5 <- pgls(X6.VPOL ~ X12.HUE, color, lambda = "ML")
    summary(lambda.resultd5)
    lambda.resultd6 <- pgls(X6.VPOL ~ X13.BRI, color, lambda = "ML")
    summary(lambda.resultd6)
    lambda.resultd7 <- pgls(X6.VPOL ~ X14.CHR, color, lambda = "ML")
    summary(lambda.resultd7)
    lambda.resultd8 <- pgls(X6.VPOL ~ X15.UV, color, lambda = "ML")
    summary(lambda.resultd8)
    lambda.resultd9 <- pgls(X6.VPOL ~ X16.GC, color, lambda = "ML")
    summary(lambda.resultd9)
    lambda.resultd10 <- pgls(X6.VPOL ~ X17.DIST, color, lambda = "ML")
    summary(lambda.resultd10)

    
    lambda.resulte1 <- pgls(X9.SIZ ~ X3.MSUG, color, lambda = "ML")
    summary(lambda.resulte1)
    lambda.resulte2 <- pgls(X9.SIZ ~ X4.CSUG, color, lambda = "ML")
    summary(lambda.resulte2)
    lambda.resulte3 <- pgls(X9.SIZ ~ X5.NPOL, color, lambda = "ML")
    summary(lambda.resulte3)
    lambda.resulte4 <- pgls(X9.SIZ ~ X6.VPOL, color, lambda = "ML")
    summary(lambda.resulte4)
    lambda.resulte5 <- pgls(X9.SIZ ~ X12.HUE, color, lambda = "ML")
    summary(lambda.resulte5)
    lambda.resulte6 <- pgls(X9.SIZ ~ X13.BRI, color, lambda = "ML")
    summary(lambda.resulte6)
    lambda.resulte7 <- pgls(X9.SIZ ~ X14.CHR, color, lambda = "ML")
    summary(lambda.resulte7)
    lambda.resulte8 <- pgls(X9.SIZ ~ X15.UV, color, lambda = "ML")
    summary(lambda.resulte8)
    lambda.resulte9 <- pgls(X9.SIZ ~ X16.GC, color, lambda = "ML")
    summary(lambda.resulte9)
    lambda.resulte10 <- pgls(X9.SIZ ~ X17.DIST, color, lambda = "ML")
    summary(lambda.resulte10)

```




```{r, echo = F}

lambda.resultf1 <- pgls(X3.MSUG ~ 1, color, lambda = "ML")
    summary(lambda.resultf1)
lambda.resultf2 <- pgls(X4.CSUG ~ 1, color, lambda = "ML")
    summary(lambda.resultf2)
lambda.resultf3 <- pgls(X5.NPOL ~ 1, color, lambda = "ML")
    summary(lambda.resultf3)
lambda.resultf4 <- pgls(X6.VPOL ~ 1, color, lambda = "ML")
    summary(lambda.resultf4)
lambda.resultf5 <- pgls(X9.SIZ ~ 1, color, lambda = "ML")
    summary(lambda.resultf5)
lambda.resultf6 <- pgls(X12.HUE ~ 1, color, lambda = "ML")
    summary(lambda.resultf6)
lambda.resultf7 <- pgls(X13.BRI ~ 1, color, lambda = "ML")
    summary(lambda.resultf7)
lambda.resultf8 <- pgls(X14.CHR ~ 1, color, lambda = "ML")
    summary(lambda.resultf8)
lambda.resultf9 <- pgls(X15.UV ~ 1, color, lambda = "ML")
    summary(lambda.resultf9)
lambda.resultf10 <- pgls(X16.GC ~ 1, color, lambda = "ML")
    summary(lambda.resultf10)
lambda.resultf11 <- pgls(X17.DIST ~ 1, color, lambda = "ML")
    summary(lambda.resultf11)
    
    


    
```

Plotting

```{r, echo = F}

library(devtools)
install_github("liamrevell/phytools")
library(phytools)

rownames(mydata) <- as.character(mydata$X2.Especies2)
colors<-colorRampPalette(colors=heat.colors(100, alpha = 1))(100)
phylo.heatmap(mytree2,mydata[,c(6,7,8,9,12,15,16,17,18,19,20)],ftype="i", fsize = c(0.3,0.5,0.5),colors=colors,standardize=T,lwd=1, pts=F, grid=F, legend = T, split=c(0.75,0.25))


mytiplabels <- mydata$X2.Especies2
names(mytiplabels) = mydata$X2.SP
mytiplabels
names(mytiplabels)[match(mytree2$tip.label,mytiplabels)]
mytree3<-mytree2
mytree3$tip.label <- as.character(names(mytiplabels)[match(mytree2$tip.label,mytiplabels)])
mytree3

traits <- mydata[,c(6,7,8,9,12,15,16,17,18,19,20)]
colnames(traits) <- c("Sugar Mass", "Sugar Conc.", "Pollen Num.", "Pollen Vol.", "Flow. Size", "HUE", "BRI", "CHR", "UV", "GC", "DIST")
mydata$X2.SP <- gsub('([[:punct:]])|\\s+','_',mydata$X2.SP)
rownames(traits) <- as.character(mydata[,3])
mytree3$tip.label <- gsub('([[:punct:]])|\\s+','_',mytree3$tip.label)
colors<-colorRampPalette(colors=heat.colors(100, alpha = 1))(100)
phylo.heatmap(mytree3,traits,ftype="i", fsize = c(0.35,0.5,0.5),colors=colors,standardize=T,lwd=1, pts=F, grid=F, legend = T, split=c(0.75,0.25))


```

